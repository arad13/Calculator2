@{
    ViewBag.Title = "Home Page";
}

<div class="jumbotron">
    <h1>Calculator</h1>
</div>

<div class="row">
    <div class="col-md-12" align="center">
        <input type="text" disabled id="displayHistory" style="text-align:right" />
    </div>
</div>
<div class="row">
    <div class="col-md-12 w-100" align="center">
        <input type="text" disabled id="inputValues" style="text-align:right" value="0" />
    </div>
</div>
<div class="row">
    <div class="col-md-12" align="center">
        <div class="col-md-4">
            &nbsp;
        </div>
        <div class="col-md-4">
            <div class="col-md-4">
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">C</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">CE</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block"><-</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">/</button>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12" align="center">
        <div class="col-md-4">
            &nbsp;
        </div>
        <div class="col-md-4">
            <div class="col-md-4">
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">7</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">8</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">9</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">x</button>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12" align="center">
        <div class="col-md-4">
        </div>
        <div class="col-md-4">
            <div class="col-md-4">
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">4</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">5</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">6</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">-</button>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12" align="center">
        <div class="col-md-4">
        </div>
        <div class="col-md-4">
            <div class="col-md-4">
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">1</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">2</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">3</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">+</button>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12" align="center">
        <div class="col-md-4">
        </div>
        <div class="col-md-4">
            <div class="col-md-4">
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">+/-</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">0</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">.</button>
            </div>
            <div class="remove-padding col-md-1">
                <button type="button" class="btn-primary btn-block">=</button>
            </div>
            <div class="col-md-4">
            </div>
        </div>
        <div class="col-md-4">
        </div>
    </div>
</div>

<script type="text/javascript">
    var global_clearOnNextInput = true;
    var global_currentTotal = 0;

    $(document).ready(function () {
        $(":button").click(function () {
            var input = $(this).text()

            handleInput(input);
        });
    });

    function handleInput(input) {
        var currentVal = $("#inputValues").val();
        if ($.isNumeric(input)) {
            if (global_clearOnNextInput)
                $("#inputValues").val(input);
            else {
                $("#inputValues").val(currentVal + input);
            }
            global_clearOnNextInput = false;
        }
        else if (input == ".") {
            if (global_clearOnNextInput)
                $("#inputValues").val("0.");
            else {
                if( currentVal.indexOf(".") != -1)
                    return; // do nothing with a second decimal point
                $("#inputValues").val(currentVal + input);
            }
            global_clearOnNextInput = false;
        }
        else if (input == "<-")
            deleteLast();
        else if (input == "C")
            clearAll();
        else if (input == "CE")
            clearInput();
        else if (isOperation(input))
            handleOperation(input);
    }

    function clearAll() {
        //Clears the calculation string and input field.
        $("#inputValues").val("0");
        $("#displayHistory").val("");
        global_clearOnNextInput = true;
        global_currentTotal = 0;
    }

    function clearInput(){
        $("#inputValues").val("0");
        global_clearOnNextInput = true;
    }

    function deleteLast() {
        var inputValues = $("#inputValues").val();

        $("#inputValues").val(inputValues.substr(0, inputValues.length - 1));
    }

    function handleOperation(inputOperation) {
        //This function either adds the number in the input field to the
        //calculation string, or, if the last thing in the calculation string
        //is an operation, and the input field is empty, it replaces that operation.
        var inputValues = $("#inputValues").val();
        var displayHistory = $("#displayHistory").val();
        var lastOperation = displayHistory[displayHistory.length - 1]

        if (inputValues == "" && !$.isNumeric(lastOperation))
            displayHistory = displayHistory.substr(0, displayHistory.length - 1) + inputVal;
        else {
            //If this is not the first operation in the display, recalculate the total for the most recent operation now.
            if (isOperation(lastOperation))
                calculateTotal(lastOperation);
            else
                global_currentTotal = parseFloat(inputValues);

            //Now update our display to reflect the current input
            if (inputOperation != "=")
                displayHistory += inputValues + inputOperation;
            else
                displayHistory = "";
        }

        //Update the display history with our changes.
        $("#displayHistory").val(displayHistory);
        global_clearOnNextInput = true;
    }

    function calculateTotal(operation) {
        //This function will take the current global total, and, using the passed operation,
        //use the input value to update the current global total, and the input value field.
        var inputValues = $("#inputValues").val();

        if (operation == "+")
            global_currentTotal = global_currentTotal + parseFloat(inputValues);
        else if (operation == "-")
            global_currentTotal = global_currentTotal - parseFloat(inputValues);
        else if (operation == "x")
            global_currentTotal = global_currentTotal * parseFloat(inputValues);
        else if (operation == "/")
            global_currentTotal = global_currentTotal / parseFloat(inputValues);

        $("#inputValues").val(formatTotal(global_currentTotal.toFixed(6)));
    }

    function formatTotal(fTotal) {
        var stringTotal = String(fTotal);
        while ((stringTotal[stringTotal.length - 1] == 0 || stringTotal[stringTotal.length - 1] == ".") && stringTotal.indexOf(".") != -1) {
            stringTotal = stringTotal.substr(0, stringTotal.length - 1);
        }
        return stringTotal;
    }

    function isOperation(operation) {
        if (operation == "+" || operation == "-" || operation == "x" || operation == "/" || operation == "=")
            return true;
    }

    $(document).keypress(function (event) {
        var charPressed = String.fromCharCode(event.which);

        if (event.which == 13)
            charPressed = "=";
        else if (charPressed == "*")
            charPressed = "x";

        handleInput(charPressed);
    });

    $(document).keydown(function (event) {
        if (event.keyCode == 46)
            clearInput();
        if (event.keyCode == 8)
            deleteLast();
    });

</script>